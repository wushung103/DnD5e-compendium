{"name":"藍彈動畫","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.68CDpJv8wdDdnGI6"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 30ft, 60ft and 90ft\n//It works for animations like Scorching Ray, Fire Bolt, Arrow, Boulder Toss, Siege Projectile that use these distances\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/2nd_Level/Scorching_Ray/\";\n//anFile30 points to the file corresponding to 30ft, anFile60 for 60ft and anFile90 for 90ft\n// let anFile30 = `${folder01}ScorchingRay_01_Orange_30ft_1600x400.webm`;\n// let anFile60 = `${folder01}ScorchingRay_01_Orange_60ft_2800x400.webm`;\n// let anFile90 = `${folder01}ScorchingRay_01_Orange_90ft_4000x400.webm`;\n\n//How this macro is set up for Fire Bolt\nlet folder01 = \"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/\";\nlet anFile30 = `${folder01}LazerShot_01_Blue_30ft_1600x400.webm`;\nlet anFile60 = `${folder01}LazerShot_01_Blue_30ft_1600x400.webm`;\nlet anFile90 = `${folder01}LazerShot_01_Blue_30ft_1600x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\n\nlet anFile = anFile30;\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<=1200):\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n case (anDist>2400):\n    anFileSize = 3600;\n    anFile = anFile90;\n    anchorX = 0.05;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = anFile60;\n    anchorX = 0.071;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anDist <= 600 ? 0.6  : anScale;\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (250);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Generic/Weapon_Attacks/Ranged/LazerShot_01_Blue_Thumb.webp","actorIds":[],"_id":"0QYWSO11bDMnjpzY"}
{"name":"迷霧","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.PYtMcK4Qwwxsj6YL"}},"scope":"global","command":"let params =\n[{\n    filterType: \"fog\",\n    filterId: \"myFog\",\n    color: 0x000000,\n    density: 0.65,\n    time: 0,\n    dimX: 1,\n    dimY: 1,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 2.2, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","author":"uDAdlkna037LVJd3","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"1hPwpNePjF1DLmFl"}
{"name":"橡棍術Marcro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.cslIZHQ9ILsUGEMj"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\nif (args[0] === \"on\" && !target.getFlag('world', 'shillelagh')) {\n    let content = `\n<div class=\"form-group\">\n  <label>Weapons : </label>\n  <select name=\"weapons\">\n    ${weapon_content}\n  </select>\n</div>`;\n\n    new Dialog({\n        title: \"請選擇要賦魔的武器\",\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Ok`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    target.actor.setFlag(`world`, `shillelagh`, {\n                        id : itemId,\n                        damage : copy_item.data.damage.parts[0][0]    \n                    });\n                    let damage = copy_item.data.damage.parts[0][0];\n                    var newdamage = damage.replace(/1d(4|6)/g,\"1d8\");\n                    copy_item.data.damage.parts[0][0] = newdamage;\n                    copy_item.data.ability = \"wis\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                    ChatMessage.create({content: copy_item.name + \" 已賦魔\"});\n                }\n            },\n            Cancel:\n            {\n                label: `Cancel`\n            }\n        }\n    }).render(true);\n}\n\nif (args[0] === \"off\") {\n    let flag = target.actor.getFlag(`world`, `shillelagh`);\n    let itemId = flag.id;\n    let damage = flag.damage;\n    let item = target.actor.items.get(itemId);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts[0][0] = damage;\n    copy_item.data.ability = \"\";\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `shillelagh`);\n    ChatMessage.create({content: copy_item.name + \" 上的魔法解除了\"});\n\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/enchant-jade-1.jpg","actorIds":[],"_id":"1n9bhtRiYxi0f46u"}
{"name":"至聖斬Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.oPNCqJHrvoAxfrrQ"}},"scope":"global","command":"/*\n * The Smite macro emulates the Divine Smite feature of Paladins in DnD 5e. A spell slot level to use\n * can be selected, which increases the number of damage dice, and smiting a fiend or undead\n * will also increase the number of damage dice.\n * \n * If a token is not selected, the macro will default back to the default character for the Actor. \n * This allows for the GM to cast the macro on behalf a character that possesses it, \n * without requiring that a PC have their character selected.\n * To execute the macro a target MUST be specified and, unless configured otherwise, the character must have an available spell slot. \n * Make your regular attack and then if you choose to use Divine Smite, run this macro.\n */\n\n(() => {\n\n//Configurable variables\nlet maxSpellSlot = 5; //  Highest spell-slot level that may be used.\nlet affectedCreatureTypes = [\"邪魔\", \"不死生物\", \"不死生物(變形)\"]; //  Creature types that take extra damage.\n\n// Use token selected, or default character for the Actor if none is.\nlet s_actor = canvas.tokens.controlled[0]?.actor || game.user.character;     \n\n// Verifies if the actor can smite.\nif (s_actor?.data.items.find(i => i.name === \"至聖斬 Divine Smite\") === undefined){\n    return ui.notifications.error(`所選角色不具備施展至聖斬的能力`);\n}\n\nlet confirmed = false;\nif (hasAvailableSlot(s_actor)) {\n\n    // Get options for available slots\n    let optionsText = \"\";\n    for (let i = 1; i < maxSpellSlot; i++) {\n        const slots = getSpellSlots(s_actor, i);\n        if (slots.value > 0) {\n            const level = CONFIG.DND5E.spellLevels[i];\n            const label = game.i18n.format('DND5E.SpellLevelSlot', {level: level, n: slots.value});\n            optionsText += `<option value=\"${i}\">${label}</option>`;\n        }\n    }\n\n    // Create a dialogue box to select spell slot level to use when smiting.\n    new Dialog({\n        title: \"至聖斬Divine Smite\",\n        content: `\n        <form id=\"smite-use-form\">\n            <p>` + game.i18n.format(\"DND5E.AbilityUseHint\", {name: \"Divine Smite\", type: \"feature\"}) + `</p>\n            <div class=\"form-group\">\n                <label>Spell Slot Level</label>\n                <div class=\"form-fields\">\n                    <select name=\"slot-level\">` + optionsText + `</select>\n                </div>\n            </div>\n\n            <div class=\"form-group\">\n                <label class=\"checkbox\">\n                <input type=\"checkbox\" name=\"consumeCheckbox\" checked/>` + game.i18n.localize(\"DND5E.SpellCastConsume\") + `</label>\n            </div>\n\n            <div class=\"form-group\">\n                <label class=\"checkbox\">\n                <input type=\"checkbox\" name=\"criticalCheckbox\"/>` + game.i18n.localize(\"DND5E.CriticalHit\") + \"?\" + `</label>\n            </div>\n        </form>\n        `,\n        buttons: {\n            one: {\n                icon: '<i class=\"fas fa-check\"></i>',\n                label: \"SMITE!\",\n                callback: () => confirmed = true\n            },\n            two: {\n                icon: '<i class=\"fas fa-times\"></i>',\n                label: \"Cancel\",\n                callback: () => confirmed = false\n            }\n        },\n        default: \"Cancel\",\n        close: html => {\n            if (confirmed) {\n                const slotLevel = parseInt(html.find('[name=slot-level]')[0].value);\n                const criticalHit = html.find('[name=criticalCheckbox]')[0].checked;\t\t\t\t\n                const consumeSlot = html.find('[name=consumeCheckbox]')[0].checked;\n                smite(s_actor, slotLevel, criticalHit, consumeSlot);\n            }\n        }\n    }).render(true);\n\n} else {\n    return ui.notifications.error(`No spell slots available to use this feature.`);    \n}\n\n/**\n * Gives the spell slot information for a particular actor and spell slot level.\n * @param {Actor5e} actor - the actor to get slot information from.\n * @param {integer} level - the spell slot level to get information about. level 0 is deprecated.\n * @returns {object} contains value (number of slots remaining), max, and override.\n */\nfunction getSpellSlots(actor, level) {\n    return actor.data.data.spells[`spell${level}`];\n}\n\n/**\n * Returns whether the actor has any spell slot left.\n * @param {Actor5e} actor - the actor to get slot information from.\n * @returns {boolean} True if any spell slots of any spell level are available to be used.\n */\n function hasAvailableSlot(actor) {\n    for (let slot in actor.data.data.spells) {\n        if (actor.data.data.spells[slot].value > 0) {\n            return true;\n        }\n    }\n    return false;\n }\n\n/**\n * Use the controlled token to smite the targeted token.\n * @param {Actor5e} actor - the actor that is performing the action.\n * @param {integer} slotLevel - the spell slot level to use when smiting.\n * @param {boolean} criticalHit - whether the hit is a critical hit.\n * @param {boolean} consume - whether to consume the spell slot.\n */\nfunction smite(actor, slotLevel, criticalHit, consume) {\n    let targets = game.user.targets;\n    let chosenSpellSlots = getSpellSlots(actor, slotLevel);\n\n    if (chosenSpellSlots.value < 1) {\n        ui.notifications.error(\"No spell slots of the required level available.\");\n        return;\n    }\n    if (targets.size !== 1) {\n        ui.notifications.error(\"You must target exactly one token to Smite.\");\n        return;\n    }\n\n    targets.forEach(target => {\n        let numDice = slotLevel + 1;\n        let type = target.actor.data.data.details.type?.toLocaleLowerCase();\n        if (affectedCreatureTypes.includes(type)) numDice += 1;\n        if (criticalHit) numDice *= 2;\n        const flavor = `Macro Divine Smite - ${game.i18n.localize(\"DND5E.DamageRoll\")} (${game.i18n.localize(\"DND5E.DamageRadiant\")})`;\n        new Roll(`${numDice}d8`).roll().toMessage({ flavor: flavor, speaker });\n    })\n\n    if (consume){\n        let objUpdate = new Object();\n        objUpdate['data.spells.spell' + slotLevel + '.value'] = chosenSpellSlots.value - 1;\n        actor.update(objUpdate);\n    }\n}\n\n})();","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/beam-orange-3.jpg","actorIds":[],"_id":"5SMjlO08xFXbnI6c"}
{"name":"ActorSetFlag","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.6keeWvkYs6H43lHm"}},"scope":"global","command":"//args[0] = token ID\r\n//args[1]-[3] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\ncanvas.tokens.get(args[0]).actor.setFlag(args[1], args[2], args[3]);\r\n\r\n","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/core/icons/svg/dice-target.svg","actorIds":[],"_id":"66h0B0x4QpJj1QNC"}
{"name":"ActorGetFlag","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.LIxsEoRzLeEAAsZd"}},"scope":"global","command":"return canvas.tokens.get(args[0]).actor.getFlag(args[1], args[2]);","author":"uDAdlkna037LVJd3","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"7hU7i24wVRYnFTG6"}
{"name":"移除特效","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.louNQauk7UbD2fCK"}},"scope":"global","command":"// Delete all filters on the selected tokens/tiles\nTokenMagic.deleteFiltersOnSelected();","author":"uDAdlkna037LVJd3","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"9FgzXLXpPAmzcZ8i"}
{"name":"更改Token視線/光源","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.soTfO1EWK0mAeRqJ"}},"scope":"global","command":"// Open a dialog for quickly changing token vision parameters of the controlled tokens.\n// This macro was written by @Sky#9453\n// https://github.com/Sky-Captain-13/foundry\n\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"請先選擇一個Tokan\");\n\nlet applyChanges = false;\nnew Dialog({\n  title: `Token視線設定`,\n  content: `\n    <form>\n      <div class=\"form-group\">\n        <label>視線類型:</label>\n        <select id=\"vision-type\" name=\"vision-type\">\n          <option value=\"nochange\">不改變</option>\n          <option value=\"dim0\">自己</option>\n          <option value=\"dim30\">黑暗視覺(30 ft)</option>\n          <option value=\"dim60\">黑暗視覺(60 ft)</option>\n          <option value=\"dim90\">黑暗視覺(90 ft)</option>\n          <option value=\"dim120\">黑暗視覺(120 ft)</option>\n          <option value=\"dim150\">黑暗視覺(150 ft)</option>\n          <option value=\"dim180\">黑暗視覺(180 ft)</option>\n          <option value=\"bright120\">魔鬼視界(Warlock)</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label>光源類型:</label>\n        <select id=\"light-source\" name=\"light-source\">\n          <option value=\"nochange\">不改變</option>\n          <option value=\"none\">無光源</option>\n          <option value=\"candle\">蠟燭</option>\n          <option value=\"lamp\">提燈</option>\n          <option value=\"bullseye\">牛眼提燈</option>\n          <option value=\"hooded-dim\">加蓋提燈(暗)</option>\n          <option value=\"hooded-bright\">加蓋提燈(亮)</option>\n          <option value=\"light\">亮光術</option>\n          <option value=\"torch\">火炬</option>\n        </select>\n      </div>\n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Changes`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel Changes`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n    if (applyChanges) {\n      for ( let token of canvas.tokens.controlled ) {\n        let visionType = html.find('[name=\"vision-type\"]')[0].value || \"none\";\n        let lightSource = html.find('[name=\"light-source\"]')[0].value || \"none\";\n        let dimSight = 0;\n        let brightSight = 0;\n        let dimLight = 0;\n        let brightLight = 0;\n        let lightAngle = 360;\n        let lockRotation = token.data.lockRotation;\n        // Get Vision Type Values\n        switch (visionType) {\n          case \"dim0\":\n            dimSight = 0;\n            brightSight = 0;\n            break;\n          case \"dim30\":\n            dimSight = 30;\n            brightSight = 0;\n            break;\n          case \"dim60\":\n            dimSight = 60;\n            brightSight = 0;\n            break;\n          case \"dim90\":\n            dimSight = 90;\n            brightSight = 0;\n            break;\n          case \"dim120\":\n            dimSight = 120;\n            brightSight = 0;\n            break;\n          case \"dim150\":\n            dimSight = 150;\n            brightSight = 0;\n            break;\n          case \"dim180\":\n            dimSight = 180;\n            brightSight = 0;\n            break;\n          case \"bright120\":\n            dimSight = 0;\n            brightSight= 120;\n            break;\n          case \"nochange\":\n          default:\n            dimSight = token.data.dimSight;\n            brightSight = token.data.brightSight;\n        }\n        // Get Light Source Values\n        switch (lightSource) {\n          case \"none\":\n            dimLight = 0;\n            brightLight = 0;\n            break;\n          case \"candle\":\n            dimLight = 10;\n            brightLight = 5;\n            break;\n          case \"lamp\":\n            dimLight = 45;\n            brightLight = 15;\n            break;\n          case \"bullseye\":\n            dimLight = 120;\n            brightLight = 60;\n            lockRotation = false;\n            lightAngle = 52.5;\n            break;\n          case \"hooded-dim\":\n            dimLight = 5;\n            brightLight = 0;\n            break;\n          case \"hooded-bright\":\n            dimLight = 60;\n            brightLight = 30;\n            break;\n          case \"light\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"torch\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"nochange\":\n          default:\n            dimLight = token.data.dimLight;\n            brightLight = token.data.brightLight;\n            lightAngle = token.data.lightAngle;\n            lockRotation = token.data.lockRotation;\n        }\n        // Update Token\n        console.log(token);\n        token.update({\n          vision: true,\n          dimSight: dimSight,\n          brightSight: brightSight,\n          dimLight: dimLight,\n          brightLight:  brightLight,\n          lightAngle: lightAngle,\n          lockRotation: lockRotation\n        });\n      }\n    }\n  }\n}).render(true);","author":"uDAdlkna037LVJd3","img":"icons/sundries/lights/lantern-iron-yellow.webp","actorIds":[],"_id":"CK8bSWJHce2Lbm6y"}
{"name":"箭矢動畫","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.68CDpJv8wdDdnGI6"},"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 30ft, 60ft and 90ft\n//It works for animations like Scorching Ray, Fire Bolt, Arrow, Boulder Toss, Siege Projectile that use these distances\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/2nd_Level/Scorching_Ray/\";\n//anFile30 points to the file corresponding to 30ft, anFile60 for 60ft and anFile90 for 90ft\n// let anFile30 = `${folder01}ScorchingRay_01_Orange_30ft_1600x400.webm`;\n// let anFile60 = `${folder01}ScorchingRay_01_Orange_60ft_2800x400.webm`;\n// let anFile90 = `${folder01}ScorchingRay_01_Orange_90ft_4000x400.webm`;\n\n//How this macro is set up for Fire Bolt\nlet folder01 = \"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/\";\nlet anFile30 = `${folder01}Arrow_Simple_01_30ft_1600x400.webm`;\nlet anFile60 = `${folder01}Arrow_Simple_01_60ft_2800x400.webm`;\nlet anFile90 = `${folder01}Arrow_Simple_01_90ft_4000x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"This macro depends on the FXMaster module. Make sure it is installed and enabled\");\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\n\nlet anFile = anFile30;\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<=1200):\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n case (anDist>2400):\n    anFileSize = 3600;\n    anFile = anFile90;\n    anchorX = 0.05;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = anFile60;\n    anchorX = 0.071;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anDist <= 600 ? 0.6  : anScale;\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (250);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Generic/Weapon_Attacks/Ranged/Arrow_Simple_01_Thumb.webp","actorIds":[],"_id":"COQzclI5E9WJD0VK"}
{"name":"攝心目光Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.yrTB6zHbr4HwYGnS"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet ConditionControl = game.macros.getName(\"CUB Condition\");\n\n/**\n * Dialog appears on players screen, CondtionControll callback execute on GM end \n */\n\nfunction EyebiteDialog() {\n    new Dialog({\n        title: \"攝心目光效應\",\n        content: \"<p>請標記一個目標生物，選擇一種效應</p>\",\n        buttons: {\n            one: {\n                label: \"沉睡\",\n                callback: async () => {\n                    for (let target of game.user.targets) {\n                        let { total } = await target.actor.rollAbilitySave(\"wis\");\n                        if (total < args[2]) {\n                            ChatMessage.create({ content: target.name + \" 豁免失敗 \"});\n                            ConditionControl.execute(\"apply\", \"昏迷\", target);\n                        }\n else {\n                            ChatMessage.create({ content: target.name + \" 豁免成功 \" });\n                        }\n                    }\n                }\n            },\n            two: {\n                label: \"驚慌\",\n                callback: async () => {\n                    for (let target of game.user.targets) {\n                        let { total } = await target.actor.rollAbilitySave(\"wis\");\n                        if (total < args[2]) {\n                            ChatMessage.create({ content: target.name + \" 豁免失敗 \"});\n                            ConditionControl.execute(\"apply\", \"恐慌\", target);\n                        }\n else {\n                            ChatMessage.create({ content: target.name + \" 豁免成功 \"  });\n                        }\n                    }\n                }\n            },\n            three: {\n                label: \"患病\",\n                callback: async () => {\n                    for (let target of game.user.targets) {\n                        let { total } = await target.actor.rollAbilitySave(\"wis\");\n                        if (total < args[2]) {\n                            ChatMessage.create({ content: target.name + \" 豁免失敗 \"});\n                            ConditionControl.execute(\"apply\", \"中毒\", target);\n                        }\n else {\n                            ChatMessage.create({ content: target.name + \" 豁免成功 \" });\n                        }\n                    }\n                }\n            },\n        }\n    }).render(true);\n}\n\nif (args[0] === \"on\") {\n    const hookId = Hooks.on(\"updateCombat\", (combat, update) => {\n        if (!(\"round\" in update || \"turn\" in update)) return;\n        if (combat.combatant.tokenId === args[1]) {\n            EyebiteDialog();\n        }\n    });\n    target.actor.setFlag(\"world\", \"EyebiteSpell\", hookId);\n    ChatMessage.create({ content: target.name + \" 獲得【攝心目光Eyebite】\" });\n    EyebiteDialog();\n\n}\n\n//Cleanup hooks and flags.\nif (args[0] === \"off\") {\n    async function off() {\n        ChatMessage.create({ content: \"【攝心目光Eyebite】效應中止\" });\n        let hookIdFlag = await target.actor.getFlag(\"world\", \"EyebiteSpell\");\n        Hooks.off(\"updateCombat\", hookIdFlag);\n    }\n    off();\n    target.actor.unsetFlag(\"world\", \"EyebiteSpell\");\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/evil-eye-red-3.jpg","actorIds":[],"_id":"Cj8noGQzpQ59mBmV"}
{"name":"CUB Condition","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.WdwVdMQmK7EhPkKV"}},"scope":"global","command":"let target = args[2];\nif(args[0] === \"apply\"){\n    game.cub.addCondition(args[1], target)\n}\nif(args[0] === \"remove\") {\n    game.cub.removeCondition(args[1], target )\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/core/icons/svg/dice-target.svg","actorIds":[],"_id":"DgZ6CbhQdMdnCW6e"}
{"name":"強化能力Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.uwhN6zTM7HTzX8QC"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \n\nlet target = canvas.tokens.get(args[1]);\n\n/**\n * For each target select the effect (GM selection)\n */\nif (args[0] === \"on\") {\n    new Dialog({\n        title: \"請選擇要強化的能力 \",\n        buttons: {\n            one: {\n                label: \"熊之堅韌 Bear’s Endurance\",\n                callback: () => {\n                    let formula = `2d6`;\n                    let amount = new Roll(formula).roll().total;\n                    target.actor.setFlag('world', 'enhanceAbility', {\n                        name: \"bear\",\n                    });\n                    ChatMessage.create({ content: target.name + \"獲得\" + amount + \"點臨時生命值\" });\n                    target.update({ \"data.attributes.hp.temp\": amount });\n\n                }\n            },\n            two: {\n                label: \"牛之蠻力 Bull’s Strength\",\n                callback: () => {\n                    ChatMessage.create({ content: target.name + \"的負重能力倍增了\" });\n                    target.actor.setFlag('world', 'enhanceAbility', {\n                        name: \"bull\",\n                    });\n                    target.actor.setFlag('dnd5e', 'powerfulBuild', true);\n                }\n            },\n            three: {\n                label: \"其他能力\",\n                callback: () => {\n                    target.actor.setFlag('world', 'enhanceAbility', {\n                        name: \"other\",\n                    });\n                    ChatMessage.create({ content: \"該強化能力無法自動計算，請DM自己加油。\" });\n                }\n            }\n        }\n    }).render(true);\n}\n\nif (args[0] === \"off\") {\n    let flag = target.actor.getFlag('world', 'enhanceAbility');\n    if (flag.name === \"bull\") target.actor.unsetFlag('dnd5e', 'powerfulBuild', false);\n    target.actor.unsetFlag('world', 'enhanceAbility');\n    ChatMessage.create({ content: \"強化能力的效果結束了\" });\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/haste-royal-2.jpg","actorIds":[],"_id":"DslAiqrb5ssvO8Ti"}
{"name":"創造舞光球(綠)","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.78gwoZysOGs10uQv"}},"scope":"global","command":"let d = new Dialog({\n    title: \"創造舞光球\",\n    content: \"<p>在角色列表中已有舞光球可供使用\",\n    buttons: {\n        one: {\n         icon: '<i class=\"fas fa-check\"></i>',\n         label: \"OK\",        \n        },\n      \n    },\n});\nd.render(true);\n\n(async ()=>{\n    let testFolder = game.folders.find(f => f.name === \"舞光球\" && f.type === \"Actor\");\n    if(!testFolder) testFolder = await Folder.create({ name : `舞光球`, type : `Actor`, parent : null });\n  \n    await Actor.create({\n      name: \"舞光球 - 綠色\",\n      type: \"character\",\n      img: \"modules/JB2A_DnD5e/Library/Cantrip/Dancing_Lights/DancingLights_01_Green_Thumb.webp\",\n      folder: testFolder.id,\n      sort: 12000,\n      token: { img: \"modules/JB2A_DnD5e/Library/Cantrip/Dancing_Lights/DancingLights_*.webm\", scale: 0.8},\n      \"token.randomImg\": true,\n      \"token.vision\": true,\n      \"token.dimLight\": 10,\n      \"token.lightAnimation\":{type: \"torch\", speed: 3, intensity: 7},\n      \"token.lightColor\": \"#a2c973\",\n      \"token.lightAlpha\": 0.2,\n    })\n  })();","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Cantrip/Dancing_Lights/DancingLights_01_Green_Thumb.webp","actorIds":[],"_id":"ERg9N8kY0Fkqz8mV"}
{"name":"移除狀態","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.lAwOC7obhkPjKeuf"}},"scope":"global","command":"//remove all conditions\nfor ( let token of canvas.tokens.controlled ){\n  token.update({\"effects\": []});\n}","author":"uDAdlkna037LVJd3","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"GgCePnvTB3k18XZp"}
{"name":"放逐術Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.iO0OLVjnVC8mz9i0"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]); //find target\n\nif (args[0] === \"on\") {\n    target.update({hidden : true}); // hide targeted token\n    ChatMessage.create({content: target.name + \" 被驅逐了\"});\n    \n}\nif(args[0]=== \"off\") {\n target.update({hidden : false}); // unhide token\n ChatMessage.create({content: target.name + \"  已回歸\"});\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/link-eerie-3.jpg","actorIds":[],"_id":"InLeWrxmQQDcGST3"}
{"name":"物理命中","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.B14ZptISDhdxLYtd"},"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"//This macro plays the animation on selected targets with no trajectory\n//It works for animations like Cure Wounds, Healing Ability and Dizzy Stars \n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Cure Wounds Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n//folder 01 is the directory path to the assets\nlet folder01 = \"modules/animated-spell-effects-cartoon/spell-effects/cartoon/air/\";\n//anFile is the name of the file used for the animation\nlet anFile = `${folder01}air_blast_CIRCLE_01.webm`;\n\n//another example would be:\n//let folder01 = \"modules/JB2A_DnD5e/Library/Generic/Healing/\"\n//let anFile = `${folder01}HealingAbility_01_Green_200x200.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請選取目標');\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\n\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet tarScale = ((mainTarget.data.width + mainTarget.data.height)/2);\n\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: mainTarget.center,\n                      anchor: {\n                       x: 0.5,\n                       y: 0.5\n                      },\n                      angle: 0,\n                      scale: {\n                       x: 0.4,\n                       y: 0.4\n                      }\n                    }; \ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (75);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/skills/blood_11.jpg","actorIds":[],"_id":"IoYjMx4RjHh9C0HE"}
{"name":"英雄宴Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.OFmbN8LvQCsDvrrT"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \n\n\nlet target = canvas.tokens.get(args[1]);\nlet amount = new Roll(\"2d10\").roll().total;\n/**\n * Update HP and Max HP to roll formula, save result as flag\n */\nif (args[0] === \"on\") {\n        let hpMax = target.actor.data.data.attributes.hp.max;\n        let hp = target.actor.data.data.attributes.hp.value;\n        await target.actor.update({\"data.attributes.hp.max\": (hpMax + amount), \"data.attributes.hp.value\": (hp + amount) });\n        ChatMessage.create({content: `【英雄宴】 ${target.name} 生命值上限提升 ${amount} 點`});\n        await target.actor.setFlag('world', 'HeroesFeast', amount);\n};\n\n// Remove Max Hp and reduce HP to max if needed\nif (args[0] === \"off\") {\n        let amountOff = await target.actor.getFlag('world', 'HeroesFeast');\n        let hpMax = target.actor.data.data.attributes.hp.max;\n        let newHpMax = hpMax - amountOff;\n        await target.actor.update({\"data.attributes.hp.max\": newHpMax });\n        if ( target.actor.data.data.attributes.hp.value > newHpMax ) {\n            await target.actor.update({\"data.attributes.hp.value\": newHpMax });\n        }\n        ChatMessage.create({content: \"【英雄宴】\" + target.name + \"的生命值提升效果結束\"});\n        target.actor.unsetFlag('world', 'HeroesFeast');\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/heal-royal-3.jpg","actorIds":[],"_id":"JYDsD2Zy4vSQDhbm"}
{"name":"綠彈動畫","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.68CDpJv8wdDdnGI6"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 30ft, 60ft and 90ft\n//It works for animations like Scorching Ray, Fire Bolt, Arrow, Boulder Toss, Siege Projectile that use these distances\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/2nd_Level/Scorching_Ray/\";\n//anFile30 points to the file corresponding to 30ft, anFile60 for 60ft and anFile90 for 90ft\n// let anFile30 = `${folder01}ScorchingRay_01_Orange_30ft_1600x400.webm`;\n// let anFile60 = `${folder01}ScorchingRay_01_Orange_60ft_2800x400.webm`;\n// let anFile90 = `${folder01}ScorchingRay_01_Orange_90ft_4000x400.webm`;\n\n//How this macro is set up for Fire Bolt\nlet folder01 = \"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/\";\nlet anFile30 = `${folder01}LazerShot_01_Green_30ft_1600x400.webm`;\nlet anFile60 = `${folder01}LazerShot_01_Green_30ft_1600x400.webm`;\nlet anFile90 = `${folder01}LazerShot_01_Green_30ft_1600x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\n\nlet anFile = anFile30;\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<=1200):\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n case (anDist>2400):\n    anFileSize = 3600;\n    anFile = anFile90;\n    anchorX = 0.05;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = anFile60;\n    anchorX = 0.071;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anDist <= 600 ? 0.6  : anScale;\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (250);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Generic/Weapon_Attacks/Ranged/LazerShot_01_Green_Thumb.webp","actorIds":[],"_id":"L9ggVhX9Lrga5QiV"}
{"name":"紫色追魂","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.8CSStDFwPkXZUdDy"},"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"/// This macro pulls from the JB2A list of Magic Missiles to throw 1 random path at targeted tokens\n\n//folder01 targets the Magic Missile Folder\nlet folder01 = \"modules/JB2A_DnD5e/Library/1st_Level/Magic_Missile/\";\n//Each file is then defined as a variable that will be stored in an array and then chose at random\nlet mmA = `${folder01}MagicMissile_01_Purple_30ft_01_1600x400.webm`;\nlet mmB = `${folder01}MagicMissile_01_Purple_30ft_02_1600x400.webm`;\nlet mmC = `${folder01}MagicMissile_01_Purple_30ft_03_1600x400.webm`;\nlet mmD = `${folder01}MagicMissile_01_Purple_30ft_04_1600x400.webm`;\nlet mmE = `${folder01}MagicMissile_01_Purple_30ft_05_1600x400.webm`;\nlet mmF = `${folder01}MagicMissile_01_Purple_30ft_06_1600x400.webm`;\nlet mmG = `${folder01}MagicMissile_01_Purple_30ft_07_1600x400.webm`;\nlet mmH = `${folder01}MagicMissile_01_Purple_30ft_08_1600x400.webm`;\nlet mmI = `${folder01}MagicMissile_01_Purple_30ft_09_1600x400.webm`;\n\nlet mmAA = `${folder01}MagicMissile_01_Purple_60ft_01_2800x400.webm`;\nlet mmBB = `${folder01}MagicMissile_01_Purple_60ft_02_2800x400.webm`;\nlet mmCC = `${folder01}MagicMissile_01_Purple_60ft_03_2800x400.webm`;\nlet mmDD = `${folder01}MagicMissile_01_Purple_60ft_04_2800x400.webm`;\nlet mmEE = `${folder01}MagicMissile_01_Purple_60ft_05_2800x400.webm`;\nlet mmFF = `${folder01}MagicMissile_01_Purple_60ft_06_2800x400.webm`;\nlet mmGG = `${folder01}MagicMissile_01_Purple_60ft_07_2800x400.webm`;\nlet mmHH = `${folder01}MagicMissile_01_Purple_60ft_08_2800x400.webm`;\nlet mmII = `${folder01}MagicMissile_01_Purple_60ft_09_2800x400.webm`;\n\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n\n\n\nfunction random_itemA(itemsA)\n{\nreturn itemsA[Math.floor(Math.random()*itemsA.length)];\n}\n\nvar itemsA = [mmA, mmB, mmC, mmD, mmE, mmF, mmG, mmH, mmI];\n\nfunction random_itemB(itemsB)\n{\nreturn itemsB[Math.floor(Math.random()*itemsB.length)];\n}\n\nvar itemsB = [mmAA, mmBB, mmCC, mmDD, mmEE, mmFF, mmGG, mmHH, mmII];\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\nlet anFile = random_itemA(itemsA);\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<1800):\n    anFileSize = 1200;\n    anFile = random_itemA(itemsA);\n    anchorX = 0.125;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = random_itemB(itemsB);\n    anchorX = 0.071;\n    break;\n}\n\n\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anScale;\nif (anDist<=600){anScaleY = 0.5}\nif (anDist>600 && anDist <1000){anScaleY = 0.66}\nif (anDist>=1000 && anDist <1800){anScaleY = anScale}\nif (anDist>=1800 && anDist <2400){anScaleY = 0.8}\nif (anDist>=2400){anScaleY = anScale}\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\nawait wait (80);\n\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (50);\n}\n}\nCast()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/1st_Level/Magic_Missile/MagicMissile_01_Purple_Thumb.webp","actorIds":[],"_id":"Lxbfu2adIqYAqUQV"}
{"name":"藍色EB","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.AFtnE8v55aIK2h6h"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 15ft, 30ft and 45ft\n//It works for Throwing Dagger, Ray of Frost, Disintegrate\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/Cantrip/Ray_Of_Frost/\";\n//anFile 15 for the 15ft file, anFile30 for 30ft and anFile 45 for 45ft\n// let anFile15 = `${folder01}RayOfFrost_01_Blue_15ft_1000x400.webm`;\n// let anFile30 = `${folder01}RayOfFrost_01_Blue_30ft_1600x400.webm`;\n// let anFile45 = `${folder01}RayOfFrost_01_Blue_45ft_2200x400.webm`;\n\n//How you would set it up for the Thrown Dagger01\n// let folder01 = \"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/\";\n// let anFile15 = `${folder01}ThrowingWeapon_Dagger01_15ft_1000x400.webm`;\n// let anFile30 = `${folder01}ThrowingWeapon_Dagger01_30ft_1600x400.webm`;\n// let anFile45 = `${folder01}ThrowingWeapon_Dagger01_45ft_2200x400.webm`;\n\n//How this macro is set up for Disintegrate\nlet folder01 = \"modules/JB2A_DnD5e/Library/Cantrip/Ray_Of_Frost/\";\nlet anFile15 = `${folder01}RayOfFrost_01_Blue_15ft_1000x400.webm`;\nlet anFile30 = `${folder01}RayOfFrost_01_Blue_30ft_1600x400.webm`;\nlet anFile45 = `${folder01}RayOfFrost_01_Blue_45ft_2200x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\nlet anFile = anFile15;\nlet anFileSize = 600;\nlet anchorX = 0.2;\nswitch(true){\n case (anDist<=600):\n    anFileSize = 600;\n    anFile = anFile15;\n    anchorX = 0.2;\n    break;\n case (anDist>1200):\n    anFileSize = 1800;\n    anFile = anFile45;\n    anchorX = 0.091;\n    break;\n default:\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anScale;\nif (anDist<=300){anScaleY = 0.7}\nif (anDist>=400 && anDist<=600){anScaleY = anScale*0.9}\nif (anDist>=700 && anDist<=900){anScaleY = 0.8}\nif (anDist>=1000 && anDist<=1200){anScaleY = anScale*0.9}\nif (anDist>=1300 && anDist<=1500){anScaleY = 0.6}\nif (anDist>=1600 && anDist<=1800){anScaleY = 0.8}\nif (anDist>=1800){anScaleY = anScale}\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (500);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Cantrip/Ray_Of_Frost/RayOfFrost_01_Blue_Thumb.webp","actorIds":[],"_id":"Mo9sI0CKRljHfUIa"}
{"name":"EnlargeReduce","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.tKKbvoCkf5A37rsc"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \n\n/**\n * For each target, the GM will have to choose \n */\nlet target = canvas.tokens.get(args[1]);\nlet originalSize = target.data.width;\nlet mwak = target.actor.data.data.bonuses.mwak.damage;\n\nif (args[0] === \"on\") {\n    new Dialog({\n        title: \"變巨／縮小術 Enlarge/Reduce\",\n        buttons: {\n            one: {\n                label: \"變巨大\",\n                callback: () => {\n                    let bonus = mwak + \" 1d4\";\n                    let enlarge = (originalSize + 1);\n                    target.actor.update({ \"data.bonuses.mwak.damage\": bonus });\n                    target.update({ \"width\": enlarge, \"height\": enlarge });\n                    target.actor.setFlag('world', 'enlageReduceSpell', {\n                        size: originalSize,\n                        ogMwak: mwak,\n                    });\n                    ChatMessage.create({ content: target.name + \" 變大了!\" });\n                }\n            },\n            two: {\n                label: \"縮小小\",\n                callback: () => {\n                    let bonus = mwak + \" -1d4\";\n                    let size = originalSize;\n                    let newSize = (size > 1) ? (size - 1) : (size - 0.3);\n                    target.actor.update({ \"data.bonuses.mwak.damage\": bonus });\n                    target.update({ \"width\": newSize, \"height\": newSize });\n                    target.actor.setFlag('world', 'enlageReduceSpell', {\n                        size: originalSize,\n                        ogMwak: mwak,\n                    });\n                    ChatMessage.create({ content: target.name + \" 變小了!\" });\n                }\n            },\n        }\n    }).render(true);\n}\nif (args[0] === \"off\") {\n    let flag = target.actor.getFlag('world', 'enlageReduceSpell');\n    target.actor.update({ \"data.bonuses.mwak.damage\": flag.ogMwak });\n    target.update({ \"width\": flag.size, \"height\": flag.size });\n    target.actor.unsetFlag('world', 'enlageReduceSpell');\n    ChatMessage.create({ content: target.name + \" 已恢復原尺寸\" });\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/link-blue-2.jpg","actorIds":[],"_id":"RnuVQlO6Jf6NjUs3"}
{"name":"火焰刀Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.SlQPN9cea6VW9R5d"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @item.level\n\nlet target = canvas.tokens.get(args[1])\nlet data = {}\n/**\n * Create Flame Blade item in inventory\n */\nif (args[0] === \"on\") {\n  let weaponDamge = 2 + Math.floor(args[2] / 2);\n  await target.actor.createOwnedItem(\n    {\n      \"name\": \"火焰刀\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"quantity\": 1,\n        \"activation\": {\n          \"type\": \"action\",\n          \"cost\": 1,\n          \"condition\": \"\"\n        },\n        \"duration\": {\n          \"value\": null,\n          \"units\": \"\"\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"units\": \"\",\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 5,\n          \"long\": null,\n          \"units\": \"\"\n        },\n        \"uses\": {\n          \"value\": 0,\n          \"max\": 0,\n          \"per\": \"\"\n        },\n        \"consume\": {\n          \"type\": \"\",\n          \"target\": \"\",\n          \"amount\": null\n        },\n        \"ability\": \"\",\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${weaponDamge}d6`,\n              \"fire\"\n            ]\n          ],\n          \"versatile\": \"\"\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true,\n      },\n      \"img\": \"systems/dnd5e/icons/spells/enchant-orange-2.jpg\",\n    }\n  );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n  let item = target.actor.data.items.find(i => i.name === \"火焰刀\" && i.type === \"weapon\")\n  target.actor.deleteOwnedItem(item._id)\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/enchant-orange-2.jpg","actorIds":[],"_id":"USIal59Ym9PL07wo"}
{"name":"獵人印記","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"dnd5e":{"itemMacro":true},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.Dho60hcIGhkbIu1G"}},"scope":"global","command":"//This marco is designed to be used in conjunction with MarkAttackWrapper.json\n//and GMConditions.js.\n\n//It is designed to replace the standard rollItemMacro for either the Hex\n//spell or the hunter's mark Spell on either the warlock or ranger, but\n//it will work on any class with hex or hunter's mark by changing the Localization\n//parameters. To use hex, replace warlockName variable below and if you\n//would like to use it with hunter's mark replace rangerName variable below.\n\n// CAUTION! if you change your global damage variables while this macro is\n//active the change will be erased. It should work fine with dynamic effects.\n\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//This macro is designed to be used with the combat utility belt module.\n//and the furnace module. Once you have it installed, you will have to enable \n//enhanced conditions, and create a condition called 'Marked' as the Localization \n//parameter below. You just need to update that parameter to match whatever condition \n//name you want if you want to use a different name in condition lab.\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n//Localization\nconst rangerName = \"Ranger\";\nconst warlockName = \"Warlock\";\nconst rangerSpell = \"獵人印記\";\nconst warlockSpell = \"Hex\";\nconst condition = \"Marked\";\nconst flagScope = \"world\";\n\n//parameters\nif (!token) ui.notifications.error(\"Please select your token first.\");\nlet myToken = token;\nconst markDmg = \" + 1d6\";\nif (!game.user.targets.values().next().value) {\n  ui.notifications.error(\"Please select one target\");\n}\nconst target = game.user.targets.values().next().value;\n\nconst conditionList = target.data.effects;\nconst actorId = myToken.actor._id + \"_mark\";\nconst bonuses = myToken.actor.data.data.bonuses;\nlet className = \"\";\nlet spellName = \"\";\nlet gm_macro = null\n\n//Check to make sure that the GM has the GMConditions macro assigned.\ntry{\n    gm_macro = game.macros.entities.find(mb => mb.name === \"GMConditions\");\n}\ncatch(err)\n{\n    ui.notifications.error(\"GMConditions Macro was not found\")\n}\n\n//If Move flag and condition to a new selected target\nfunction move() {\n  let swapTarget = myToken.getFlag(flagScope, actorId);\n  const remCon = canvas.tokens.get(swapTarget.targetId);\n  gm_macro.execute(\"remove\", condition, swapTarget.targetId);\n  swapTarget.targetId = target.data._id;\n  (async () => {\n    await myToken.unsetFlag(flagScope, actorId);\n    myToken.setFlag(flagScope, actorId, swapTarget);\n  })();\n  gm_macro.execute(\"apply\", condition, target.id);\n  console.log();\n}\n\n//revert global damage to base, remove the condition and unset flag\n\nfunction remove() {\n  const flagId = myToken.getFlag(flagScope, actorId);\n\n  let obj = {\n    \"data.bonuses.mwak.damage\": flagId.meleeAtk,\n    \"data.bonuses.rwak.damage\": flagId.rangeAtk,\n    \"data.bonuses.msak.damage\": flagId.meleeSpell,\n    \"data.bonuses.rsak.damage\": flagId.rangeSpell\n  };\n\n  updateActor(myToken, obj);\n\n  const remFlag = canvas.tokens.get(flagId.targetId);\n\n  (async () => {\n    await gm_macro.execute(\"remove\", condition, flagId.targetId);\n    await myToken.unsetFlag(flagScope, actorId);\n  })();\n}\n\n// User input to move or remove flag and condition\n\nfunction alterMark() {\n  const d = new Dialog({\n    title: \"Mark Enemy\",\n    content: \"<p>Would you like to move or remove?</p>\",\n    buttons: {\n      one: {\n        icon: '<i class=\"fas fa-check\"></i>',\n        label: \"Move\",\n        callback: () => move()\n      },\n      two: {\n        icon: '<i class=\"fas fa-times\"></i>',\n        label: \"Remove\",\n        callback: () => remove()\n      }\n    },\n    default: \"two\",\n    close: () => console.log(\"Dialog closed\")\n  }).render(true);\n}\n\n// cast the spell, apply the condition, create and set flag\n\nasync function castSpell() {\n  try {\n    await game.dnd5e.rollItemMacro(spellName);\n  } catch (err) {\n    return null;\n  }\n  gm_macro.execute(\"apply\", condition, target.id);\n\n  let globalDmg = {\n    targetId: target.data._id,\n    meleeAtk: bonuses.mwak.damage,\n    rangeAtk: bonuses.rwak.damage,\n    meleeSpell: bonuses.msak.damage,\n    rangeSpell: bonuses.rsak.damage,\n    isSet: false\n  };\n  myToken.setFlag(flagScope, actorId, globalDmg);\n}\n\n//If the class is ranger and has the hunter's mark spell, set the spell name\n//or say the spell doesn't exist.\n\nfunction setRangerSpell() {\n  className = rangerName;\n  if (actor.items.find(i => i.name === `${rangerSpell}`)) {\n    spellName = rangerSpell;\n    castSpell();\n  } else {\n    ui.notifications.error(\n      \"Selected actor does not have the \" + rangerSpell + \" spell.\"\n    );\n    console.log(\"Selected actor does not have the \" + rangerSpell + \" spell.\");\n    return null;\n  }\n}\n\n//If the class is warlock and has the hex spell set the spell name\n//if say the spell doesn't exist\n\nfunction setWarlockSpell() {\n  className = warlockName;\n  if (actor.items.find(i => i.name === `${warlockSpell}`)) {\n    spellName = warlockSpell;\n    castSpell();\n  } else {\n    ui.notifications.error(\n      \"Selected actor does not have the \" + warlockSpell + \" spell.\"\n    );\n    console.log(\"Selected actor does not have the \" + warlockSpell + \" spell.\");\n    return null;\n  }\n}\n\n//check whether the token is a ranger or warlock\n\nfunction checkSpell() {\n  if (actor.items.find(i => i.name === `${rangerName}`)) {\n    setRangerSpell();\n  } else if (actor.items.find(i => i.name === `${warlockName}`)) {\n    setWarlockSpell();\n  } else {\n    ui.notifications.error(\n      \"Please select a \" + rangerName + \" or \" + warlockName + \" token.\"\n    );\n    console.log(\n      \"Please select a \" + rangerName + \" or \" + warlockName + \" token.\"\n    );\n  }\n}\n\nasync function updateActor(updateToken, obj) {\n  await updateToken.actor.update(obj);\n}\n\n//If the flag exists call functions to move or remove if it doesn't exist\n// call function to cast the spell\n\nif (myToken.getFlag(flagScope, actorId)) {\n  alterMark();\n} else {\n  checkSpell();\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/evil-eye-red-1.jpg","actorIds":[],"_id":"WGkr7WDU2nYcAm0x"}
{"name":"魔法武器Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.6avU8avuuue4Q8hE"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\nfunction value_limit(val, min, max) {\n    return val < min ? min : (val > max ? max : val);\n};\n\n//Filter for weapons\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\n\n/**\n * Select for weapon and apply bonus based on spell level\n */\nif (args[0] === \"on\") {\n    let content = `\n    <div class=\"form-group\">\n    <label>Weapons : </label>\n    <select name=\"weapons\">\n        ${weapon_content}\n        </select>\n    </div>`;\n\n    new Dialog({\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Ok`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    let spellLevel = Math.floor(args[2] / 2);\n                    let bonus = value_limit(spellLevel, 1, 3);\n                    let wpDamage = copy_item.data.damage.parts[0][0];\n                    target.actor.setFlag(`world`, `magicWeapon`, {\n                        damage: item.data.attackBonus,\n                        weapon: itemId,\n                        weaponDmg: wpDamage,\n                    }\n                    );\n                    copy_item.data.attackBonus = (copy_item.data.attackBonus + bonus);\n                    copy_item.data.damage.parts[0][0] = (wpDamage + \" + \" + bonus);\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                }\n            },\n            Cancel:\n            {\n                label: `Cancel`\n            }\n        }\n    }).render(true);\n}\n\n//Revert weapon and unset flag.\nif (args[0] === \"off\") {\n    let { damage, weapon, weaponDmg } = target.actor.getFlag('world', 'magicWeapon');\n    let item = target.actor.items.get(weapon);\n    let copy_item = duplicate(item);\n    copy_item.data.attackBonus = (copy_item.data.attackBonus - damage);\n    copy_item.data.damage.parts[0][0] = weaponDmg;\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `magicWeapon`);\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/enchant-blue-2.jpg","actorIds":[],"_id":"XYjSuMSVGsJdCp85"}
{"name":"火焰彈","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.68CDpJv8wdDdnGI6"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 30ft, 60ft and 90ft\n//It works for animations like Scorching Ray, Fire Bolt, Arrow, Boulder Toss, Siege Projectile that use these distances\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/2nd_Level/Scorching_Ray/\";\n//anFile30 points to the file corresponding to 30ft, anFile60 for 60ft and anFile90 for 90ft\n// let anFile30 = `${folder01}ScorchingRay_01_Orange_30ft_1600x400.webm`;\n// let anFile60 = `${folder01}ScorchingRay_01_Orange_60ft_2800x400.webm`;\n// let anFile90 = `${folder01}ScorchingRay_01_Orange_90ft_4000x400.webm`;\n\n//How this macro is set up for Fire Bolt\nlet folder01 = \"modules/JB2A_DnD5e/Library/Cantrip/Fire_Bolt/\";\nlet anFile30 = `${folder01}FireBolt_01_Regular_Orange_30ft_1600x400.webm`;\nlet anFile60 = `${folder01}FireBolt_01_Regular_Orange_60ft_2800x400.webm`;\nlet anFile90 = `${folder01}FireBolt_01_Regular_Orange_90ft_4000x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\n\nlet anFile = anFile30;\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<=1200):\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n case (anDist>2400):\n    anFileSize = 3600;\n    anFile = anFile90;\n    anchorX = 0.05;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = anFile60;\n    anchorX = 0.071;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anDist <= 600 ? 0.6  : anScale;\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (250);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Cantrip/Fire_Bolt/FireBolt_01_Regular_Orange_Thumb.webp","actorIds":[],"_id":"aiN9QqerOGFnjK8v"}
{"name":"聖療Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.jy7zlw8utzdqEkat"}},"scope":"global","command":"/**\n * System: D&D5e\n * Apply lay-on-hands feat to a target character.  Asks the player how many HP to heal and\n * verifies the entered value is within range before marking down usage counter. If the player\n * has OWNER permissions of target (such as GM or self-heal) the HP are applied automatically; \n * otherwise, a 'roll' message appears allowing the target character to right-click to apply healing.\n */\n\nlet confirmed = false;\nlet actorData = actor || canvas.tokens.controlled[0] || game.user.character;\nlet featData = actorData ? actorData.items.find(i => i.name===\"聖療 Lay on Hands\") : null;\n\nif(actorData == null || featData == null) \n    ui.notifications.warn(`你為並未習得【聖療 Lay on Hands技能】`);\nelse if (game.user.targets.size !== 1)\n    ui.notifications.warn(`請選擇施法目標`);\nelse\n{\n    let featUpdate = duplicate(featData);\n    let targetActor = game.user.targets.values().next().value.actor;\n    let maxHeal = Math.clamped(featUpdate.data.uses.value, 0, \n        targetActor.data.data.attributes.hp.max - targetActor.data.data.attributes.hp.value);\n\n    let content = `<p><b>【${actorData.name}】對【${targetActor.data.name}】施展聖療.</b></p>\n                    <p>你希望恢復多少HP?</p>\n                    <form>\n                        <div class=\"form-group\">\n                            <label for=\"num\">HP恢復量(完全回滿需= ${maxHeal}點):</label>\n                            <input id=\"num\" name=\"num\" type=\"number\" min=\"0\" max=\"${maxHeal}\"></input>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"flavor\">Flavor:</label>\n                            <input id=\"flavor\" name=\"flavor\" value=\"${featUpdate.data.chatFlavor}\"></input>\n                        </div>\n                    </form>`;\n    new Dialog({\n        title: \"聖療 Lay on Hands\",\n        content: content,      \n        buttons: {\n            heal: { label: \"治癒!\", callback: () => confirmed = true },\n            cancel: { label: \"取消施法\", callback: () => confirmed = false }\n        },\n        default: \"heal\",\n\n        close: html => {\n            if (confirmed) \n            {\n                let number = Math.floor(Number(html.find('#num')[0].value));\n                if (number < 1 || number > maxHeal)\n                    ui.notifications.warn(`輸入數值無效，施法中斷。`);\n                else\n                {\n                    let flavor = `<strong>${html.find('#flavor')[0].value}</strong><br>`;\n                    if (targetActor.permission !== CONST.ENTITY_PERMISSIONS.OWNER)\n                        // We need help applying the healing, so make a roll message for right-click convenience.\n                        new Roll(`${number}`).roll().toMessage({\n                            speaker: ChatMessage.getSpeaker(),\n                            flavor: `【${actorData.name}】對【${targetActor.data.name}】施展聖療.<br>${flavor}\n                            <p><em>回覆HP ${number} 點` });\n                    else {\n                        // We can apply healing automatically, so just show a normal chat message.\n                        ChatMessage.create({\n                            speaker: ChatMessage.getSpeaker(),\n                            content: `【${actorData.name}】對【${targetActor.data.name}】施展聖療，恢復HP ${number} 點.<br>${flavor}`\n                        });\n                        targetActor.update({\"data.attributes.hp.value\" : targetActor.data.data.attributes.hp.value + number});\n                    }\n\n                    featUpdate.data.uses.value = featUpdate.data.uses.value - number;\n                    actorData.updateEmbeddedEntity(\"OwnedItem\", featUpdate);\n                };\n            }\n        }\n    }).render(true);\n}","author":"uDAdlkna037LVJd3","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"gSpfSu7UuXIefmgO"}
{"name":"Deck of Many Things","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.DfH9pgQvPCzRF1qV"}},"scope":"global","command":"const table = game.tables.entities.find(t => t.name === \"Deck of Many Things\");\ntable.draw();","author":"uDAdlkna037LVJd3","img":"icons/sundries/gaming/playing-cards-grey.webp","actorIds":[],"_id":"h6UbKfi5rbvNq5x5"}
{"name":"GMConditions","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.EjqFxrT7x1YTHbJX"}},"scope":"global","command":"//This macro must be called 'GMConditions' and be on the GM's\n//hot bar for the castMark.js macro to function correctly.\n//you must tick the option 'Excecute Macro As GM' to grant\n//players access to this macro.\n\n\nconst action = args[0]\nconst condition = args[1]\nconst targetId = args[2]\nconst target = canvas.tokens.get(targetId);\nif (action == \"apply\"){\n    game.cub.addCondition(condition, target, {replaceExisting: true})\n}\nelse if (action == \"remove\"){\n    game.cub.removeCondition(condition, target, {warn: true});\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/5fbe5ec1f959b5dea569b164/worlds/DamnAdventurers/Player%20Assets/%E6%88%B4%E5%80%AB%20Pic(.png","actorIds":[],"_id":"jdPuFVs1VwkAXYhH"}
{"name":"英雄氣概Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.Hpovl7B98Lq81YHO"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target @abilities.(insert casting score).mod\n\n\nlet mod = args[2];\nlet target = canvas.tokens.get(args[1]);\n\nif (args[0] === \"on\") {\n    ChatMessage.create({ content: target.name + \"受到了加護\" })\n    const hookId = Hooks.on(\"updateCombat\", (combat, update) => {\n        if (!(\"round\" in update || \"turn\" in update)) return;\n        if (combat.combatant.tokenId === args[1]) {\n            target.actor.update({ \"data.attributes.hp.temp\": mod });\n            ChatMessage.create({ content: target.name + \"身上的加護持續著\"　})\n        }\n    });\n    target.actor.setFlag(\"world\", \"heroismUpdateCombatHookId\", hookId);\n\n}\nif (args[0] === \"off\") {\n   let hookIdFlag = target.actor.getFlag(\"world\", \"heroismUpdateCombatHookId\");\n    ChatMessage.create({ content: target.name + \"身上的加護停止了\" });\n    Hooks.off(\"updateCombat\", hookIdFlag);\n    target.actor.unsetFlag(\"world\", \"heroismUpdateCombatHookId\");\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/heal-sky-2.jpg","actorIds":[],"_id":"jwticLqw4XfPb2ao"}
{"name":"ActorUpdate","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.gCnaEz5xK3oP11uI"}},"scope":"global","command":"//args[0] = actor ID\r\n//args[1] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\n(async()=>{\r\n  await canvas.tokens.get(args[0]).actor.update(args[1]);\r\n})();","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/core/icons/svg/dice-target.svg","actorIds":[],"_id":"p4lwUeREHd0Jutny"}
{"name":"創造火球/篝火","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.wH1oxGvmKdTAvy06"},"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"let d = new Dialog({\n  title: \"創造火球/篝火\",\n  content: \"<p>火球已經新增到腳色清單，請將它拖曳到地圖上使用。\",\n  buttons: {\n      one: {\n       icon: '<i class=\"fas fa-check\"></i>',\n       label: \"OK\",\n       //callback: () => console.log(\"Chose One\")\n      },\n    \n  },\n});\nd.render(true);\n\n(async ()=>{\n    let testFolder = game.folders.find(f => f.name === \"創造火球/篝火\" && f.type === \"Actor\");\n    if(!testFolder) testFolder = await Folder.create({ name : `創造火球/篝火`, type : `Actor`, parent : null });\n  \n    await Actor.create({\n      name: \"火球/篝火\",\n      type: \"npc\",\n      img: \"modules/JB2A_DnD5e/Library/2nd_Level/Flaming_Sphere/FlamingSphere_01_Orange_Thumb.webp\",\n      folder: testFolder.id,\n      sort: 12000,\n      token: { img: \"modules/JB2A_DnD5e/Library/2nd_Level/Flaming_Sphere/FlamingSphere_01_Orange_200x200.webm\", scale:0.3},\n\"token.scale.ratio\": 0.3,      \n      \"token.vision\": true,\n      \"token.disposition\": 0.5,\n      \"token.dimLight\": 40,\n      \"token.brightLight\": 20,\n      \"token.lightAnimation\":{type: \"torch\", speed: 10, intensity: 1},\n      \"token.lightColor\": \"#ffde85\",\n      \"token.lightAlpha\": 0.09,\n    })\n  })();","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/2nd_Level/Flaming_Sphere/FlamingSphere_01_Orange_Thumb.webp","actorIds":[],"_id":"qBO2MmyB3n7nqlzJ"}
{"name":"火焰護盾Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.bvIHiiIZMdgXaAzn"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\n\nif (args[0] === \"on\") {\n    if (token) {   \n        new Dialog({\n            title: \"溫暖護盾(冷凍抗性)\",\n            buttons: {\n                one: {\n                    label: \"溫暖護盾(冷凍抗性)\",\n                    callback: () => {\n                        let resistances = target.actor.data.data.traits.dr.value;\n                        resistances.push(\"cold\");\n                        target.actor.update({ \"data.traits.dr.value\": resistances });\n                        target.actor.setFlag('world', 'FireShield', \"cold\");\n                        ChatMessage.create({ content: target.name + \" 對冷凍傷害具有抗性\" });\n                    }\n                },\n                two: {\n                    label: \"凍寒護盾(火焰抗性)\",\n                    callback: () => {\n                        let resistances = target.actor.data.data.traits.dr.value;\n                        resistances.push(\"fire\");\n                        target.actor.update({ \"data.traits.dr.value\": resistances });\n                        target.actor.setFlag('world', 'FireShield', \"fire\");\n                        ChatMessage.create({ content: target.name + \"對火焰傷害有抗性\" });\n                    }\n                },\n            }\n        }).render(true);\nlet params =\n[{\n    filterType: \"xfire\",\n    filterId: \"mySparksXFire\",\n    time: 0,\n    blend: 2,\n    amplitude: 0.7,\n    dispersion: 0,\n    chromatic: false,\n    scaleX: 2,\n    scaleY: 2,\n    inlay: false,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: -0.0015, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);\n    }\n}\nif (args[0] === \"off\") {\n    let element = target.actor.getFlag('world', 'FireShield');\n    let resistances = target.actor.data.data.traits.dr.value;\n    const index = resistances.indexOf(element);\n    resistances.splice(index, 1);\n    target.actor.update({ \"data.traits.dr.value\": resistances });\n    ChatMessage.create({ content: target.name + \"身上的護盾效果結束了\"});\nTokenMagic.deleteFilters(_token);\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/protect-red-3.jpg","actorIds":[],"_id":"tqKpqqrXef4x7MS1"}
{"name":"ActorUnSetFlag","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.WjEFOameOgKDV97B"}},"scope":"global","command":"//args[0] = token ID\r\n//args[1]-[3] = update data\r\n\r\nif(!args[0] || !args[1]) return ui.notifications.error(`${this.name}'s arguments are invalid.`);\r\n\r\ncanvas.tokens.get(args[0]).actor.unsetFlag(args[1], args[2]);\r\n","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/core/icons/svg/dice-target.svg","actorIds":[],"_id":"uVyMxhPFWaQW4jgT"}
{"name":"高等隱形術Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.2XqFC9vr6cX7gPOy"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1])\nif (args[0] === \"on\") {\n    ChatMessage.create({ content: `${target.name} 隱形了` });\n    target.update({ \"hidden\": true });\n}\nif (args[0] === \"off\") {\n    ChatMessage.create({ content: `${target.name} 現形了` });\n    target.update({ \"hidden\": false });\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/fog-sky-2.jpg","actorIds":[],"_id":"vlL1YWBJ6mP8ZeZg"}
{"name":"隱形術Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.tw3fOFIdx3EAzYjS"}},"scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target\n\nlet target = canvas.tokens.get(args[1])\nif (args[0] === \"on\") {\n    ChatMessage.create({ content: `${target.name} 隱形了` });\n    target.update({ \"hidden\": true });\n}\nif (args[0] === \"off\") {\n    ChatMessage.create({ content: `${target.name} 現形了` });\n    target.update({ \"hidden\": false });\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/fog-sky-2.jpg","actorIds":[],"_id":"vtKHcq260SVdKorK"}
{"name":"紅彈動畫","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"core":{"sourceId":"Macro.68CDpJv8wdDdnGI6"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//This macro plays the animation on selected targets with a trajectory and distances of 30ft, 60ft and 90ft\n//It works for animations like Scorching Ray, Fire Bolt, Arrow, Boulder Toss, Siege Projectile that use these distances\n//Import this macro, duplicate it and change its name making sure it's unique by adding the colour (i.e. \"Ray Of Frost Blue\").\n//If it has the exact same name as the spell or item you want to trigger it from, you'll encounter an issue.\n\n//folder 01 is the directory path to the assets\n// let folder01 = \"modules/JB2A_DnD5e/Library/2nd_Level/Scorching_Ray/\";\n//anFile30 points to the file corresponding to 30ft, anFile60 for 60ft and anFile90 for 90ft\n// let anFile30 = `${folder01}ScorchingRay_01_Orange_30ft_1600x400.webm`;\n// let anFile60 = `${folder01}ScorchingRay_01_Orange_60ft_2800x400.webm`;\n// let anFile90 = `${folder01}ScorchingRay_01_Orange_90ft_4000x400.webm`;\n\n//How this macro is set up for Fire Bolt\nlet folder01 = \"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/\";\nlet anFile30 = `${folder01}LazerShot_01_Red_30ft_1600x400.webm`;\nlet anFile60 = `${folder01}LazerShot_01_Red_30ft_1600x400.webm`;\nlet anFile90 = `${folder01}LazerShot_01_Red_30ft_1600x400.webm`;\n\n\nif(game.user.targets.size == 0) ui.notifications.error('請至少選取一個目標');\nif(canvas.tokens.controlled.length == 0) ui.notifications.error(\"請選取你的Token\");\n///Check if Module dependencies are installed or returns an error to the user\nif (!canvas.fxmaster) ui.notifications.error(\"這個Marco需要搭配FXMaster module使用，請確保它功能啟動\");\n\nconst wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n\nasync function Cast() {\nvar myStringArray = Array.from(game.user.targets)[0];\nvar arrayLength = game.user.targets.size;\nfor (var i = 0; i < arrayLength; i++) {\n\nlet mainTarget = Array.from(game.user.targets)[i];\nlet myToken = canvas.tokens.controlled [0];\n\nlet ray = new Ray(myToken.center, mainTarget.center);\nlet anDeg = -(ray.angle * 57.3);\nlet anDist = ray.distance;\n\n\nlet anFile = anFile30;\nlet anFileSize = 1200;\nlet anchorX = 0.125;\nswitch(true){\n case (anDist<=1200):\n    anFileSize = 1200;\n    anFile = anFile30;\n    anchorX = 0.125;\n    break;\n case (anDist>2400):\n    anFileSize = 3600;\n    anFile = anFile90;\n    anchorX = 0.05;\n    break;\n default:\n    anFileSize = 2400;\n    anFile = anFile60;\n    anchorX = 0.071;\n    break;\n}\n\nlet anScale = anDist / anFileSize;\nlet anScaleY = anDist <= 600 ? 0.6  : anScale;\n\nlet spellAnim = \n                    {\n                     file: anFile,\n                      position: myToken.center,\n                      anchor: {\n                       x: anchorX,\n                       y: 0.5\n                      },\n                      angle: anDeg,\n                      scale: {\n                       x: anScale,\n                       y: anScaleY\n                      }\n                    }; \n\ncanvas.fxmaster.playVideo(spellAnim);\ngame.socket.emit('module.fxmaster', spellAnim);\nawait wait (250);\n}\n}\nCast ()","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/modules/JB2A_DnD5e/assets/Library/Generic/Weapon_Attacks/Ranged/LazerShot_01_Red_Thumb.webp","actorIds":[],"_id":"zb9LXz7kmcqzpcZW"}
{"_id":"1n9bhtRiYxi0f46u","name":"橡棍術Macro","permission":{"default":0,"uDAdlkna037LVJd3":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.cslIZHQ9ILsUGEMj"}},"scope":"global","command":"let target = canvas.tokens.get(args[1]);\nlet weapons = target.actor.items.filter(i => i.data.type === `weapon`);\nlet weapon_content = ``;\n\nfor (let weapon of weapons) {\n    weapon_content += `<option value=${weapon.id}>${weapon.name}</option>`;\n}\nif (args[0] === \"on\" && !target.getFlag('world', 'shillelagh')) {\n    let content = `\n<div class=\"form-group\">\n  <label>Weapons : </label>\n  <select name=\"weapons\">\n    ${weapon_content}\n  </select>\n</div>`;\n\n    new Dialog({\n        title: \"請選擇要賦魔的武器\",\n        content,\n        buttons:\n        {\n            Ok:\n            {\n                label: `Ok`,\n                callback: (html) => {\n                    let itemId = html.find('[name=weapons]')[0].value;\n                    let item = target.actor.items.get(itemId);\n                    let copy_item = duplicate(item);\n                    target.actor.setFlag(`world`, `shillelagh`, {\n                        id : itemId,\n                        damage : copy_item.data.damage.parts[0][0]    \n                    });\n                    let damage = copy_item.data.damage.parts[0][0];\n                    var newdamage = damage.replace(/1d(4|6)/g,\"1d8\");\n                    copy_item.data.damage.parts[0][0] = newdamage;\n                    copy_item.data.ability = \"wis\";\n                    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n                    ChatMessage.create({content: copy_item.name + \" 已賦魔\"});\n                }\n            },\n            Cancel:\n            {\n                label: `Cancel`\n            }\n        }\n    }).render(true);\n}\n\nif (args[0] === \"off\") {\n    let flag = target.actor.getFlag(`world`, `shillelagh`);\n    let itemId = flag.id;\n    let damage = flag.damage;\n    let item = target.actor.items.get(itemId);\n    let copy_item = duplicate(item);\n    copy_item.data.damage.parts[0][0] = damage;\n    copy_item.data.ability = \"\";\n    target.actor.updateEmbeddedEntity(\"OwnedItem\", copy_item);\n    target.actor.unsetFlag(`world`, `shillelagh`);\n    ChatMessage.create({content: copy_item.name + \" 上的魔法解除了\"});\n\n}","author":"uDAdlkna037LVJd3","img":"https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/enchant-jade-1.jpg","actorIds":[]}
